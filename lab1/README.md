# Лабораторная работа 1

**Название:** "Разработка драйверов символьных устройств"

**Цель работы:** получить знания и навыки разработки драйверов символьных устройств 
                 для операционной системы Linux.

## Описание функциональности драйвера

1. Драйвер создает символьное устройство *var3*.
2. Драйвер создает интерфейс для получения сведений о результатах операций 
   над созданным в п.1 символьным устройством: файл */proc/var3*.
3. Драйвер производит логирование всех действий драйвера и ошибок в кольцевой 
   буфер ядра.  
4. Драйвер позволяет передать символьную строку в символьное устройство 
   и получить в ответ сумму всех чисех в данной строке, разделенных другими символами.
5. Драйвер сохраняет последовательность полученных результатов с момента загрузки 
   модуля ядра.
6. Драйвер позволяет вывести последовательность полученных результатов в консоль 
   пользователя.
7. Драйвер позволяет вывести последовательность полученных результатов в кольцевой 
   буфер ядра.

## Инструкция по сборке

1. Для сборки установочных файлов драйвера необходимо выполнить команду 
   из директории `/lab1`
```
make
```
2. Для установки драйвера после сборки необходимо выполнить команду
```
sudo insmod char_dev_drv.ko
```
3. Для удаления драйвера необходимо выполнить команду
```
sudo rmmod char_dev_drv
```
4. Для удаления всех установочных файлов необходимо выполнить команду
```
make Makefile clean
```

## Инструкция пользователя

Для работы с драйвером необходимо производить операции чтения/записи с файлами, 
такими как `/dev/var3` и `/proc/var3`. Обычный пользователь не имеет достаточно 
прав для проведения данных операций. Поэтому необходимо авторизироваться под 
пользователем с ***root-правами***.

---

Для передачи строки в символьное устройство для расчета суммы 
всех чисех в данной строке необходимо выполнить команду записи строки в файл 
с помощью утилит для вставки текста в файл, например:

Утилита **echo**
```
# echo "TEXT HERE" > /dev/var3
```
---

Для вывода последовательности полученных результатов в консоль пользователя или 
в кольцевой буфер ядра необходимо выполнить команду чтения из файла с помощью 
утилит для чтения текста из файла. 

Для вывода в консоль пользователя используем файл `/proc/var3`, 
а для вывода в кольцевой буфер ядра - `/dev/var3`.

Утилита **cat**
```
# cat /dev/var3
```

---

Для просмотра кольцевого буфера ядра необходимо использовать команду
```
dmesg
```

## Примеры использования
**Установка драйвера**
```
root# sudo insmod char_dev_drv.ko
root# dmesg 
[ 2724.737778] Hello!
[ 2724.739410] char_dev_drv: proc file is created
```
**Передача строки в символьное устройство**
```
root# echo "asd32d3we3" > /dev/var3 
root# dmesg 
[ 2763.129483] Driver: open()
[ 2768.190134] Driver: write(38)
[ 2776.079534] Driver: close()
```
**Вывод истории результатов в кольцевой буфер**
```
root# cat /dev/var3 
root# dmesg 
[ 3037.064337] Driver: open()
[ 3037.064348] Driver: read()
[ 3037.064349] Sum1: 38
[ 3037.064369] Driver: close()
```
**Вывод истории результатов в консоль пользователя**
```
root# cat /proc/var3 
38
root# dmesg
[ 3207.190429] proc file: read()
```
**Удаление драйвера**
```
root# sudo rmmod char_dev_drv
root# dmesg
[ 2703.418914] Bye!!!
[ 2703.418918] char_dev_drv: proc file is deleted
```
